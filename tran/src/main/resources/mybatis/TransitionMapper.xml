<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="tran.tran.dao.ITransitionDao">
	<resultMap id="transitionResultMap" type="tran.tran.model.Transition">
		<id column="id" property="id" jdbcType="VARCHAR" />
		<result column="tran_name" property="tranName" jdbcType="VARCHAR" />
		<result column="user_id" property="userId" jdbcType="VARCHAR" />
		<result column="pre_data_source_id" property="preDataSourceId"
			jdbcType="VARCHAR" />
		<result column="target_data_source_id" property="targetDataSourceId"
			jdbcType="VARCHAR" />
		<result column="operate_type" property="operateType" jdbcType="INTEGER"/>
	</resultMap>
	<sql id="transitionColumns">
		id,tran_name,user_id,pre_data_source_id,target_data_source_id,operate_type
	</sql>
	<select id="queryTransitionsByUsername" resultMap="transitionResultMap">
		select
		<include refid="transitionColumns"></include>
		from t_transition t where 
		<choose>
		    <when test="_parameter != null" >
		        t.user_id=#{_parameter,jdbcType=VARCHAR}
		    </when>
		    <otherwise>
		    	1=1
		    </otherwise>
	    </choose>
	</select>
	<insert id="insertOrUpdate" parameterType="tran.tran.model.Transition">
		<selectKey keyProperty="countType" resultType="int" order="BEFORE">
			select count(id) as countType from t_transition where id = #{id}
		</selectKey>
	    <if test="countType >0" >
			update t_transition
			set tran_name = #{tranName},
			userId = #{user_id},
			pre_data_source_id = #{preDataSourceId},
			target_data_source_id = #{targetDataSourceId},
			operate_type = #{operateType}
			where id = #{id}
	    </if>
	    <if test="countType==0">
			insert into t_transition(<include refid="transitionColumns"></include>) 
			values (#{id},#{tranName},#{userId},#{preDataSourceId},#{targetDataSourceId},#{operateType});
	    </if>
	</insert>
</mapper>